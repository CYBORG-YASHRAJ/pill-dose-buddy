import { Next// Create transporter for Gmail
const createTransporter = () => {
  if (!SENDER_EMAIL || !SENDER_PASSWORD) {
    throw new Error('Email credentials not configured')
  }
  
  return nodemailer.createTransporter({
    service: 'gmail',
    auth: {
      user: SENDER_EMAIL,
      pass: SENDER_PASSWORD
    }
  })
} NextResponse } from 'next/server'
import nodemailer from 'nodemailer'

// Email configuration from environment variables
const SENDER_EMAIL = process.env.EMAIL_SENDER
const SENDER_PASSWORD = process.env.EMAIL_PASSWORD
const RECIPIENT_EMAIL = process.env.EMAIL_RECIPIENT

// Validate environment variables
if (!SENDER_EMAIL || !SENDER_PASSWORD || !RECIPIENT_EMAIL) {
  console.error('Missing email configuration in environment variables')
}

// Create transporter for Gmail
const transporter = nodemailer.createTransport({
  service: 'gmail',
  auth: {
    user: SENDER_EMAIL,
    pass: SENDER_PASSWORD
  }
})

export async function POST(request: NextRequest) {
  try {
    // Check if email configuration is available
    if (!SENDER_EMAIL || !SENDER_PASSWORD || !RECIPIENT_EMAIL) {
      return NextResponse.json({ 
        error: 'Email configuration not properly set in environment variables' 
      }, { status: 500 })
    }

    const { type, data, language = 'en' } = await request.json()

    // Validate required fields
    if (!type || !data) {
      return NextResponse.json({ 
        error: 'Missing required fields: type and data' 
      }, { status: 400 })
    }

    // Email templates based on notification type and language
    const emailTemplates = {
      dose_created: {
        en: {
          subject: 'üíä DoseBuddy: New Medication Added',
          html: `
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
              <div style="background: white; color: #333; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div style="text-align: center; margin-bottom: 30px;">
                  <h1 style="color: #4285f4; margin: 0; font-size: 28px;">üè• DoseBuddy</h1>
                  <p style="color: #666; margin: 5px 0 0 0;">AI-Powered Medication Management</p>
                </div>
                
                <div style="background: #f8f9ff; padding: 25px; border-radius: 10px; border-left: 5px solid #4285f4; margin-bottom: 25px;">
                  <h2 style="color: #4285f4; margin: 0 0 15px 0; display: flex; align-items: center;">
                    <span style="margin-right: 10px;">üíä</span>
                    New Medication Added
                  </h2>
                  <div style="background: white; padding: 20px; border-radius: 8px; margin-top: 15px;">
                    <table style="width: 100%; border-collapse: collapse;">
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>Medication:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #4285f4; font-weight: bold;">${data.medicationName}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>Dosage:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.dosage}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>Schedule:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.schedule}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>Start Date:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.startDate}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0;"><strong>Member:</strong></td>
                        <td style="padding: 8px 0; color: #6c5ce7; font-weight: bold;">${data.memberName || 'Primary'}</td>
                      </tr>
                    </table>
                  </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                  <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="margin: 0; color: #27ae60;">
                      <strong>‚úÖ Medication successfully added to DoseBuddy system</strong>
                    </p>
                  </div>
                  <p style="color: #666; font-size: 14px; margin-bottom: 20px;">
                    This medication has been added to the smart monitoring system. You'll receive alerts for doses and adherence tracking.
                  </p>
                  <div style="text-align: center;">
                    <span style="background: #4285f4; color: white; padding: 10px 20px; border-radius: 25px; text-decoration: none; display: inline-block; font-weight: bold;">
                      üì± DoseBuddy Dashboard
                    </span>
                  </div>
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; text-align: center;">
                  <p style="color: #999; font-size: 12px; margin: 0;">
                    This is an automated notification from DoseBuddy AI ‚Ä¢ Time: ${new Date().toLocaleString()}
                  </p>
                </div>
              </div>
            </div>
          `
        },
        hi: {
          subject: 'üíä ‡§°‡•ã‡§ú‡§º‡§¨‡§°‡•Ä: ‡§®‡§à ‡§¶‡§µ‡§æ ‡§ú‡•ã‡§°‡§º‡•Ä ‡§ó‡§à',
          html: `
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
              <div style="background: white; color: #333; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div style="text-align: center; margin-bottom: 30px;">
                  <h1 style="color: #4285f4; margin: 0; font-size: 28px;">üè• ‡§°‡•ã‡§ú‡§º‡§¨‡§°‡•Ä</h1>
                  <p style="color: #666; margin: 5px 0 0 0;">AI-‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§ ‡§¶‡§µ‡§æ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®</p>
                </div>
                
                <div style="background: #f8f9ff; padding: 25px; border-radius: 10px; border-left: 5px solid #4285f4; margin-bottom: 25px;">
                  <h2 style="color: #4285f4; margin: 0 0 15px 0; display: flex; align-items: center;">
                    <span style="margin-right: 10px;">üíä</span>
                    ‡§®‡§à ‡§¶‡§µ‡§æ ‡§ú‡•ã‡§°‡§º‡•Ä ‡§ó‡§à
                  </h2>
                  <div style="background: white; padding: 20px; border-radius: 8px; margin-top: 15px;">
                    <table style="width: 100%; border-collapse: collapse;">
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡§¶‡§µ‡§æ:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #4285f4; font-weight: bold;">${data.medicationName}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡§ñ‡•Å‡§∞‡§æ‡§ï:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.dosage}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡§∏‡§Æ‡§Ø-‡§∏‡§æ‡§∞‡§£‡•Ä:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.schedule}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.startDate}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0;"><strong>‡§∏‡§¶‡§∏‡•ç‡§Ø:</strong></td>
                        <td style="padding: 8px 0; color: #6c5ce7; font-weight: bold;">${data.memberName || '‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï'}</td>
                      </tr>
                    </table>
                  </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                  <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="margin: 0; color: #27ae60;">
                      <strong>‚úÖ ‡§¶‡§µ‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§°‡•ã‡§ú‡§º‡§¨‡§°‡•Ä ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•Ä ‡§ó‡§à</strong>
                    </p>
                  </div>
                  <p style="color: #666; font-size: 14px; margin-bottom: 20px;">
                    ‡§Ø‡§π ‡§¶‡§µ‡§æ ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º ‡§¶‡•Ä ‡§ó‡§à ‡§π‡•à‡•§ ‡§Ü‡§™‡§ï‡•ã ‡§ñ‡•Å‡§∞‡§æ‡§ï ‡§î‡§∞ ‡§™‡§æ‡§≤‡§® ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§≤‡§∞‡•ç‡§ü ‡§Æ‡§ø‡§≤‡•á‡§Ç‡§ó‡•á‡•§
                  </p>
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; text-align: center;">
                  <p style="color: #999; font-size: 12px; margin: 0;">
                    ‡§Ø‡§π ‡§°‡•ã‡§ú‡§º‡§¨‡§°‡•Ä AI ‡§∏‡•á ‡§è‡§ï ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§Ö‡§ß‡§ø‡§∏‡•Ç‡§ö‡§®‡§æ ‡§π‡•à ‚Ä¢ ‡§∏‡§Æ‡§Ø: ${new Date().toLocaleString()}
                  </p>
                </div>
              </div>
            </div>
          `
        },
        ta: {
          subject: 'üíä ‡Æü‡Øã‡Æ∏‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æø: ‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡ÆÆ‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ',
          html: `
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
              <div style="background: white; color: #333; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div style="text-align: center; margin-bottom: 30px;">
                  <h1 style="color: #4285f4; margin: 0; font-size: 28px;">üè• ‡Æü‡Øã‡Æ∏‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æø</h1>
                  <p style="color: #666; margin: 5px 0 0 0;">AI-‡Æá‡ÆØ‡Æô‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡ÆÆ‡Øá‡Æ≤‡Ææ‡Æ£‡Øç‡ÆÆ‡Øà</p>
                </div>
                
                <div style="background: #f8f9ff; padding: 25px; border-radius: 10px; border-left: 5px solid #4285f4; margin-bottom: 25px;">
                  <h2 style="color: #4285f4; margin: 0 0 15px 0; display: flex; align-items: center;">
                    <span style="margin-right: 10px;">üíä</span>
                    ‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡ÆÆ‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ
                  </h2>
                  <div style="background: white; padding: 20px; border-radius: 8px; margin-top: 15px;">
                    <table style="width: 100%; border-collapse: collapse;">
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡ÆÆ‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #4285f4; font-weight: bold;">${data.medicationName}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡ÆÆ‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡Æ≥‡Æµ‡ØÅ:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.dosage}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡Æï‡Ææ‡Æ≤ ‡ÆÖ‡Æü‡Øç‡Æü‡Æµ‡Æ£‡Øà:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.schedule}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡Æ§‡Øä‡Æü‡Æï‡Øç‡Æï ‡Æ§‡Øá‡Æ§‡Æø:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.startDate}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0;"><strong>‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øç:</strong></td>
                        <td style="padding: 8px 0; color: #6c5ce7; font-weight: bold;">${data.memberName || '‡ÆÆ‡ØÅ‡Æ§‡Æ©‡Øç‡ÆÆ‡Øà'}</td>
                      </tr>
                    </table>
                  </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                  <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="margin: 0; color: #27ae60;">
                      <strong>‚úÖ ‡ÆÆ‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Æ∞‡ÆÆ‡Ææ‡Æï ‡Æü‡Øã‡Æ∏‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æø ‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡Æø‡Æ≤‡Øç ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ</strong>
                    </p>
                  </div>
                  <p style="color: #666; font-size: 14px; margin-bottom: 20px;">
                    ‡Æá‡Æ®‡Øç‡Æ§ ‡ÆÆ‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡Æ∏‡Øç‡ÆÆ‡Ææ‡Æ∞‡Øç‡Æü‡Øç ‡Æï‡Æ£‡Øç‡Æï‡Ææ‡Æ£‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡Æø‡Æ≤‡Øç ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ. ‡Æü‡Øã‡Æ∏‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Æø‡Æ©‡Øç‡Æ™‡Æ±‡Øç‡Æ±‡ØÅ‡Æ§‡Æ≤‡Øç ‡Æï‡Æ£‡Øç‡Æï‡Ææ‡Æ£‡Æø‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æ© ‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà‡Æï‡Æ≥‡Øà‡Æ™‡Øç ‡Æ™‡ØÜ‡Æ±‡ØÅ‡Æµ‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç.
                  </p>
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; text-align: center;">
                  <p style="color: #999; font-size: 12px; margin: 0;">
                    ‡Æá‡Æ§‡ØÅ ‡Æü‡Øã‡Æ∏‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æø AI ‡Æá‡Æ≤‡Æø‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡Æí‡Æ∞‡ØÅ ‡Æ§‡Ææ‡Æ©‡Æø‡ÆØ‡Æô‡Øç‡Æï‡Æø ‡ÆÖ‡Æ±‡Æø‡Æµ‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‚Ä¢ ‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç: ${new Date().toLocaleString()}
                  </p>
                </div>
              </div>
            </div>
          `
        },
        pa: {
          subject: 'üíä ‡®°‡©ã‡®ú‡®º‡®¨‡®°‡©Ä: ‡®®‡®µ‡©Ä‡®Ç ‡®¶‡®µ‡®æ‡®à ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡©Ä‡®§‡©Ä ‡®ó‡®à',
          html: `
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
              <div style="background: white; color: #333; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div style="text-align: center; margin-bottom: 30px;">
                  <h1 style="color: #4285f4; margin: 0; font-size: 28px;">üè• ‡®°‡©ã‡®ú‡®º‡®¨‡®°‡©Ä</h1>
                  <p style="color: #666; margin: 5px 0 0 0;">AI-‡®∏‡©∞‡®ö‡®æ‡®≤‡®ø‡®§ ‡®¶‡®µ‡®æ‡®à ‡®™‡©ç‡®∞‡®¨‡©∞‡®ß‡®®</p>
                </div>
                
                <div style="background: #f8f9ff; padding: 25px; border-radius: 10px; border-left: 5px solid #4285f4; margin-bottom: 25px;">
                  <h2 style="color: #4285f4; margin: 0 0 15px 0; display: flex; align-items: center;">
                    <span style="margin-right: 10px;">üíä</span>
                    ‡®®‡®µ‡©Ä‡®Ç ‡®¶‡®µ‡®æ‡®à ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡©Ä‡®§‡©Ä ‡®ó‡®à
                  </h2>
                  <div style="background: white; padding: 20px; border-radius: 8px; margin-top: 15px;">
                    <table style="width: 100%; border-collapse: collapse;">
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡®¶‡®µ‡®æ‡®à:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #4285f4; font-weight: bold;">${data.medicationName}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡®ñ‡©Å‡®∞‡®æ‡®ï:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.dosage}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡®∏‡®Æ‡®æ‡®Ç-‡®∏‡®æ‡®∞‡®£‡©Ä:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.schedule}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡®∏‡®º‡©Å‡®∞‡©Ç‡®Ü‡®§‡©Ä ‡®§‡®æ‡®∞‡©Ä‡®ñ:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.startDate}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0;"><strong>‡®Æ‡©à‡®Ç‡®¨‡®∞:</strong></td>
                        <td style="padding: 8px 0; color: #6c5ce7; font-weight: bold;">${data.memberName || '‡®Æ‡©Å‡©±‡®ñ'}</td>
                      </tr>
                    </table>
                  </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                  <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="margin: 0; color: #27ae60;">
                      <strong>‚úÖ ‡®¶‡®µ‡®æ‡®à ‡®∏‡®´‡®≤‡®§‡®æ‡®™‡©Ç‡®∞‡®µ‡®ï ‡®°‡©ã‡®ú‡®º‡®¨‡®°‡©Ä ‡®∏‡®ø‡®∏‡®ü‡®Æ ‡®µ‡®ø‡©±‡®ö ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡©Ä‡®§‡©Ä ‡®ó‡®à</strong>
                    </p>
                  </div>
                  <p style="color: #666; font-size: 14px; margin-bottom: 20px;">
                    ‡®á‡®π ‡®¶‡®µ‡®æ‡®à ‡®∏‡®Æ‡®æ‡®∞‡®ü ‡®®‡®ø‡®ó‡®∞‡®æ‡®®‡©Ä ‡®∏‡®ø‡®∏‡®ü‡®Æ ‡®µ‡®ø‡©±‡®ö ‡®∏‡®º‡®æ‡®Æ‡®≤ ‡®ï‡©Ä‡®§‡©Ä ‡®ó‡®à ‡®π‡©à‡•§ ‡®§‡©Å‡®π‡®æ‡®®‡©Ç‡©∞ ‡®ñ‡©Å‡®∞‡®æ‡®ï ‡®Ö‡®§‡©á ‡®™‡®æ‡®≤‡®£‡®æ ‡®ü‡®∞‡©à‡®ï‡®ø‡©∞‡®ó ‡®≤‡®à ‡®Ö‡®≤‡®∞‡®ü ‡®Æ‡®ø‡®≤‡®£‡®ó‡©á‡•§
                  </p>
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; text-align: center;">
                  <p style="color: #999; font-size: 12px; margin: 0;">
                    ‡®á‡®π ‡®°‡©ã‡®ú‡®º‡®¨‡®°‡©Ä AI ‡®§‡©ã‡®Ç ‡®á‡©±‡®ï ‡®∏‡®µ‡©à‡®ö‡®æ‡®≤‡®ø‡®§ ‡®∏‡©Ç‡®ö‡®®‡®æ ‡®π‡©à ‚Ä¢ ‡®∏‡®Æ‡®æ‡®Ç: ${new Date().toLocaleString()}
                  </p>
                </div>
              </div>
            </div>
          `
        }
      },
      dose_missed: {
        en: {
          subject: '‚ö†Ô∏è DoseBuddy: Missed Dose Alert',
          html: `
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white;">
              <div style="background: white; color: #333; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div style="text-align: center; margin-bottom: 30px;">
                  <h1 style="color: #e74c3c; margin: 0; font-size: 28px;">üè• DoseBuddy</h1>
                  <p style="color: #666; margin: 5px 0 0 0;">AI-Powered Medication Management</p>
                </div>
                
                <div style="background: #fff5f5; padding: 25px; border-radius: 10px; border-left: 5px solid #e74c3c; margin-bottom: 25px;">
                  <h2 style="color: #e74c3c; margin: 0 0 15px 0; display: flex; align-items: center;">
                    <span style="margin-right: 10px;">‚ö†Ô∏è</span>
                    Missed Dose Alert
                  </h2>
                  <div style="background: white; padding: 20px; border-radius: 8px; margin-top: 15px; border: 2px solid #ffebee;">
                    <table style="width: 100%; border-collapse: collapse;">
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>Medication:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #e74c3c; font-weight: bold;">${data.medicationName}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>Scheduled Time:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.scheduledTime}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>Missed By:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #e74c3c; font-weight: bold;">${data.missedDuration}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>Dosage:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.dosage}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0;"><strong>Member:</strong></td>
                        <td style="padding: 8px 0; color: #6c5ce7; font-weight: bold;">${data.memberName || 'Primary'}</td>
                      </tr>
                    </table>
                  </div>
                </div>
                
                <div style="background: #ffe8e8; padding: 20px; border-radius: 10px; margin-bottom: 25px; border: 1px solid #ffcdd2;">
                  <h3 style="color: #d32f2f; margin: 0 0 15px 0;">üìã Recommended Action:</h3>
                  <p style="margin: 0 0 10px 0; color: #666; line-height: 1.6;">
                    ${data.recommendation || 'Please consult your healthcare provider or refer to the DoseBuddy app for personalized missed dose guidance.'}
                  </p>
                  <div style="background: #fff; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <p style="margin: 0; color: #d32f2f; font-weight: bold; text-align: center;">
                      ‚ö†Ô∏è Never double your dose to make up for a missed one
                    </p>
                  </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                  <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="margin: 0; color: #1976d2;">
                      <strong>üí° Check DoseBuddy app for detailed missed dose guidance</strong>
                    </p>
                  </div>
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; text-align: center;">
                  <p style="color: #999; font-size: 12px; margin: 0;">
                    This is an automated alert from DoseBuddy AI ‚Ä¢ Time: ${new Date().toLocaleString()}
                  </p>
                </div>
              </div>
            </div>
          `
        },
        hi: {
          subject: '‚ö†Ô∏è ‡§°‡•ã‡§ú‡§º‡§¨‡§°‡•Ä: ‡§õ‡•Ç‡§ü‡•Ä ‡§π‡•Å‡§à ‡§ñ‡•Å‡§∞‡§æ‡§ï ‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä',
          html: `
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white;">
              <div style="background: white; color: #333; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div style="text-align: center; margin-bottom: 30px;">
                  <h1 style="color: #e74c3c; margin: 0; font-size: 28px;">üè• ‡§°‡•ã‡§ú‡§º‡§¨‡§°‡•Ä</h1>
                  <p style="color: #666; margin: 5px 0 0 0;">AI-‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§ ‡§¶‡§µ‡§æ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®</p>
                </div>
                
                <div style="background: #fff5f5; padding: 25px; border-radius: 10px; border-left: 5px solid #e74c3c; margin-bottom: 25px;">
                  <h2 style="color: #e74c3c; margin: 0 0 15px 0; display: flex; align-items: center;">
                    <span style="margin-right: 10px;">‚ö†Ô∏è</span>
                    ‡§õ‡•Ç‡§ü‡•Ä ‡§π‡•Å‡§à ‡§ñ‡•Å‡§∞‡§æ‡§ï ‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä
                  </h2>
                  <div style="background: white; padding: 20px; border-radius: 8px; margin-top: 15px; border: 2px solid #ffebee;">
                    <table style="width: 100%; border-collapse: collapse;">
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡§¶‡§µ‡§æ:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #e74c3c; font-weight: bold;">${data.medicationName}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§∏‡§Æ‡§Ø:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.scheduledTime}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡§õ‡•Ç‡§ü‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #e74c3c; font-weight: bold;">${data.missedDuration}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡§ñ‡•Å‡§∞‡§æ‡§ï:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.dosage}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0;"><strong>‡§∏‡§¶‡§∏‡•ç‡§Ø:</strong></td>
                        <td style="padding: 8px 0; color: #6c5ce7; font-weight: bold;">${data.memberName || '‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï'}</td>
                      </tr>
                    </table>
                  </div>
                </div>
                
                <div style="background: #ffe8e8; padding: 20px; border-radius: 10px; margin-bottom: 25px; border: 1px solid #ffcdd2;">
                  <h3 style="color: #d32f2f; margin: 0 0 15px 0;">üìã ‡§∏‡•Å‡§ù‡§æ‡§µ‡§ø‡§§ ‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à:</h3>
                  <p style="margin: 0 0 10px 0; color: #666; line-height: 1.6;">
                    ${data.recommendation || '‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•á ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡•á‡§µ‡§æ ‡§™‡•ç‡§∞‡§¶‡§æ‡§§‡§æ ‡§∏‡•á ‡§∏‡§≤‡§æ‡§π ‡§≤‡•á‡§Ç ‡§Ø‡§æ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§õ‡•Ç‡§ü‡•Ä ‡§π‡•Å‡§à ‡§ñ‡•Å‡§∞‡§æ‡§ï ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§°‡•ã‡§ú‡§º‡§¨‡§°‡•Ä ‡§ê‡§™ ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§'}
                  </p>
                  <div style="background: #fff; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <p style="margin: 0; color: #d32f2f; font-weight: bold; text-align: center;">
                      ‚ö†Ô∏è ‡§õ‡•Ç‡§ü‡•Ä ‡§π‡•Å‡§à ‡§ñ‡•Å‡§∞‡§æ‡§ï ‡§ï‡•Ä ‡§≠‡§∞‡§™‡§æ‡§à ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§≠‡•Ä ‡§≠‡•Ä ‡§¶‡•ã‡§ó‡•Å‡§®‡•Ä ‡§ñ‡•Å‡§∞‡§æ‡§ï ‡§® ‡§≤‡•á‡§Ç
                    </p>
                  </div>
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; text-align: center;">
                  <p style="color: #999; font-size: 12px; margin: 0;">
                    ‡§Ø‡§π ‡§°‡•ã‡§ú‡§º‡§¨‡§°‡•Ä AI ‡§∏‡•á ‡§è‡§ï ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä ‡§π‡•à ‚Ä¢ ‡§∏‡§Æ‡§Ø: ${new Date().toLocaleString()}
                  </p>
                </div>
              </div>
            </div>
          `
        },
        ta: {
          subject: '‚ö†Ô∏è ‡Æü‡Øã‡Æ∏‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æø: ‡Æ§‡Æµ‡Æ±‡Æø‡ÆØ ‡Æü‡Øã‡Æ∏‡Øç ‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà',
          html: `
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white;">
              <div style="background: white; color: #333; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div style="text-align: center; margin-bottom: 30px;">
                  <h1 style="color: #e74c3c; margin: 0; font-size: 28px;">üè• ‡Æü‡Øã‡Æ∏‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æø</h1>
                  <p style="color: #666; margin: 5px 0 0 0;">AI-‡Æá‡ÆØ‡Æô‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡ÆÆ‡Øá‡Æ≤‡Ææ‡Æ£‡Øç‡ÆÆ‡Øà</p>
                </div>
                
                <div style="background: #fff5f5; padding: 25px; border-radius: 10px; border-left: 5px solid #e74c3c; margin-bottom: 25px;">
                  <h2 style="color: #e74c3c; margin: 0 0 15px 0; display: flex; align-items: center;">
                    <span style="margin-right: 10px;">‚ö†Ô∏è</span>
                    ‡Æ§‡Æµ‡Æ±‡Æø‡ÆØ ‡Æü‡Øã‡Æ∏‡Øç ‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà
                  </h2>
                  <div style="background: white; padding: 20px; border-radius: 8px; margin-top: 15px; border: 2px solid #ffebee;">
                    <table style="width: 100%; border-collapse: collapse;">
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡ÆÆ‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #e74c3c; font-weight: bold;">${data.medicationName}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡Æ®‡Æø‡Æ∞‡Øç‡Æ£‡ÆØ‡Æø‡Æ§‡Øç‡Æ§ ‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.scheduledTime}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡Æ§‡Æµ‡Æ±‡Æø‡ÆØ ‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #e74c3c; font-weight: bold;">${data.missedDuration}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡ÆÆ‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡Æ≥‡Æµ‡ØÅ:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.dosage}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0;"><strong>‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øç:</strong></td>
                        <td style="padding: 8px 0; color: #6c5ce7; font-weight: bold;">${data.memberName || '‡ÆÆ‡ØÅ‡Æ§‡Æ©‡Øç‡ÆÆ‡Øà'}</td>
                      </tr>
                    </table>
                  </div>
                </div>
                
                <div style="background: #ffe8e8; padding: 20px; border-radius: 10px; margin-bottom: 25px; border: 1px solid #ffcdd2;">
                  <h3 style="color: #d32f2f; margin: 0 0 15px 0;">üìã ‡Æ™‡Æ∞‡Æø‡Æ®‡Øç‡Æ§‡ØÅ‡Æ∞‡Øà‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æ®‡Æü‡Æµ‡Æü‡Æø‡Æï‡Øç‡Æï‡Øà:</h3>
                  <p style="margin: 0 0 10px 0; color: #666; line-height: 1.6;">
                    ${data.recommendation || '‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æö‡ØÅ‡Æï‡Ææ‡Æ§‡Ææ‡Æ∞ ‡Æµ‡Æ¥‡Æô‡Øç‡Æï‡ØÅ‡Æ®‡Æ∞‡Øà‡Æï‡Øç ‡Æï‡Æ≤‡Æ®‡Øç‡Æ§‡Ææ‡Æ≤‡Øã‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æ§‡Æ©‡Æø‡Æ™‡Øç‡Æ™‡ÆØ‡Æ©‡Ææ‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æ§‡Æµ‡Æ±‡Æø‡ÆØ ‡Æü‡Øã‡Æ∏‡Øç ‡Æµ‡Æ¥‡Æø‡Æï‡Ææ‡Æü‡Øç‡Æü‡ØÅ‡Æ§‡Æ≤‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æï ‡Æü‡Øã‡Æ∏‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æø ‡ÆÜ‡Æ™‡Øç‡Æ™‡Øà‡Æ™‡Øç ‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.'}
                  </p>
                  <div style="background: #fff; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <p style="margin: 0; color: #d32f2f; font-weight: bold; text-align: center;">
                      ‚ö†Ô∏è ‡Æ§‡Æµ‡Æ±‡Æø‡ÆØ ‡Æü‡Øã‡Æ∏‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æà‡Æü‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ ‡Æá‡Æ∞‡Æü‡Øç‡Æü‡Øà ‡Æü‡Øã‡Æ∏‡Øç ‡Æé‡Æü‡ØÅ‡Æï‡Øç‡Æï ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡Ææ‡ÆÆ‡Øç
                    </p>
                  </div>
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; text-align: center;">
                  <p style="color: #999; font-size: 12px; margin: 0;">
                    ‡Æá‡Æ§‡ØÅ ‡Æü‡Øã‡Æ∏‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æø AI ‡Æá‡Æ≤‡Æø‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡Æí‡Æ∞‡ØÅ ‡Æ§‡Ææ‡Æ©‡Æø‡ÆØ‡Æô‡Øç‡Æï‡Æø ‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà ‚Ä¢ ‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç: ${new Date().toLocaleString()}
                  </p>
                </div>
              </div>
            </div>
          `
        },
        pa: {
          subject: '‚ö†Ô∏è ‡®°‡©ã‡®ú‡®º‡®¨‡®°‡©Ä: ‡®õ‡©Å‡©±‡®ü‡©Ä ‡®°‡©ã‡®ú‡®º ‡®ö‡©á‡®§‡®æ‡®µ‡®®‡©Ä',
          html: `
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white;">
              <div style="background: white; color: #333; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div style="text-align: center; margin-bottom: 30px;">
                  <h1 style="color: #e74c3c; margin: 0; font-size: 28px;">üè• ‡®°‡©ã‡®ú‡®º‡®¨‡®°‡©Ä</h1>
                  <p style="color: #666; margin: 5px 0 0 0;">AI-‡®∏‡©∞‡®ö‡®æ‡®≤‡®ø‡®§ ‡®¶‡®µ‡®æ‡®à ‡®™‡©ç‡®∞‡®¨‡©∞‡®ß‡®®</p>
                </div>
                
                <div style="background: #fff5f5; padding: 25px; border-radius: 10px; border-left: 5px solid #e74c3c; margin-bottom: 25px;">
                  <h2 style="color: #e74c3c; margin: 0 0 15px 0; display: flex; align-items: center;">
                    <span style="margin-right: 10px;">‚ö†Ô∏è</span>
                    ‡®õ‡©Å‡©±‡®ü‡©Ä ‡®°‡©ã‡®ú‡®º ‡®ö‡©á‡®§‡®æ‡®µ‡®®‡©Ä
                  </h2>
                  <div style="background: white; padding: 20px; border-radius: 8px; margin-top: 15px; border: 2px solid #ffebee;">
                    <table style="width: 100%; border-collapse: collapse;">
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡®¶‡®µ‡®æ‡®à:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #e74c3c; font-weight: bold;">${data.medicationName}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡®®‡®ø‡®∞‡®ß‡®æ‡®∞‡®§ ‡®∏‡®Æ‡®æ‡®Ç:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.scheduledTime}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡®õ‡©Å‡©±‡®ü‡®£ ‡®¶‡®æ ‡®∏‡®Æ‡®æ‡®Ç:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #e74c3c; font-weight: bold;">${data.missedDuration}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;"><strong>‡®ñ‡©Å‡®∞‡®æ‡®ï:</strong></td>
                        <td style="padding: 8px 0; border-bottom: 1px solid #eee;">${data.dosage}</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px 0;"><strong>‡®Æ‡©à‡®Ç‡®¨‡®∞:</strong></td>
                        <td style="padding: 8px 0; color: #6c5ce7; font-weight: bold;">${data.memberName || '‡®Æ‡©Å‡©±‡®ñ'}</td>
                      </tr>
                    </table>
                  </div>
                </div>
                
                <div style="background: #ffe8e8; padding: 20px; border-radius: 10px; margin-bottom: 25px; border: 1px solid #ffcdd2;">
                  <h3 style="color: #d32f2f; margin: 0 0 15px 0;">üìã ‡®∏‡©Å‡®ù‡®æ‡®è ‡®ó‡®è ‡®ï‡®¶‡®Æ:</h3>
                  <p style="margin: 0 0 10px 0; color: #666; line-height: 1.6;">
                    ${data.recommendation || '‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡®Ü‡®™‡®£‡©á ‡®∏‡®ø‡®π‡®§ ‡®∏‡©á‡®µ‡®æ ‡®™‡©ç‡®∞‡®¶‡®æ‡®§‡®æ ‡®®‡®æ‡®≤ ‡®∏‡®≤‡®æ‡®π ‡®ï‡®∞‡©ã ‡®ú‡®æ‡®Ç ‡®µ‡®ø‡®Ö‡®ï‡®§‡©Ä‡®ó‡®§ ‡®õ‡©Å‡©±‡®ü‡©Ä ‡®°‡©ã‡®ú‡®º ‡®Æ‡®æ‡®∞‡®ó‡®¶‡®∞‡®∏‡®º‡®® ‡®≤‡®à ‡®°‡©ã‡®ú‡®º‡®¨‡®°‡©Ä ‡®ê‡®™ ‡®¶‡©á‡®ñ‡©ã‡•§'}
                  </p>
                  <div style="background: #fff; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <p style="margin: 0; color: #d32f2f; font-weight: bold; text-align: center;">
                      ‚ö†Ô∏è ‡®õ‡©Å‡©±‡®ü‡©Ä ‡®°‡©ã‡®ú‡®º ‡®¶‡©Ä ‡®≠‡®∞‡®™‡®æ‡®à ‡®≤‡®à ‡®ï‡®¶‡©á ‡®µ‡©Ä ‡®¶‡©ã‡®ó‡©Å‡®£‡©Ä ‡®ñ‡©Å‡®∞‡®æ‡®ï ‡®®‡®æ ‡®≤‡®ì
                    </p>
                  </div>
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; text-align: center;">
                  <p style="color: #999; font-size: 12px; margin: 0;">
                    ‡®á‡®π ‡®°‡©ã‡®ú‡®º‡®¨‡®°‡©Ä AI ‡®§‡©ã‡®Ç ‡®á‡©±‡®ï ‡®∏‡®µ‡©à‡®ö‡®æ‡®≤‡®ø‡®§ ‡®ö‡©á‡®§‡®æ‡®µ‡®®‡©Ä ‡®π‡©à ‚Ä¢ ‡®∏‡®Æ‡®æ‡®Ç: ${new Date().toLocaleString()}
                  </p>
                </div>
              </div>
            </div>
          `
        }
      }
    }

    // Get the appropriate template
    const template = emailTemplates[type as keyof typeof emailTemplates]?.[language as keyof typeof emailTemplates['dose_created']]
    
    if (!template) {
      return NextResponse.json({ 
        error: `Unsupported notification type: ${type} or language: ${language}` 
      }, { status: 400 })
    }

    // Email options
    const mailOptions = {
      from: {
        name: 'DoseBuddy AI',
        address: SENDER_EMAIL
      },
      to: RECIPIENT_EMAIL,
      subject: template.subject,
      html: template.html
    }

    // Send email
    const info = await transporter.sendMail(mailOptions)
    
    return NextResponse.json({
      success: true,
      messageId: info.messageId,
      type,
      language,
      timestamp: new Date().toISOString(),
      recipient: RECIPIENT_EMAIL
    })

  } catch (error) {
    console.error('Email notification error:', error)
    
    return NextResponse.json({
      success: false,
      error: 'Failed to send email notification',
      details: error instanceof Error ? error.message : 'Unknown error',
      timestamp: new Date().toISOString()
    }, { status: 500 })
  }
}
